<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title>LRCFS File Renamer</title>

	<link rel="stylesheet" href="../css/index.css">
	<link rel="stylesheet" href="../../node_modules/bootstrap/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="../../node_modules/jquery-nice-select/css/nice-select.css">
	<link rel="stylesheet" href="../../node_modules/bootstrap4-toggle/css/bootstrap4-toggle.min.css">

	<script>window.$ = window.jQuery = require('jquery');</script>
	<script>require("../../node_modules/jquery-nice-select")</script>
	<script>require("../../node_modules/popper.js")</script>
	<script>require("../../node_modules/bootstrap")</script>
	<script>require("../../node_modules/bootstrap4-toggle")</script>

	<script>require("./index")</script>
</head>
<body>

	<div class="modal" id="progressLoadingMetadata" tabindex="-1" role="dialog" aria-labelledby="progressLoadingMetadata" aria-hidden="false">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="progressLoadingMetadata">Loading Metadata</h5>
				</div>
				<div class="modal-body">
					<div class="lds-ring"><div></div><div></div><div></div><div></div></div>
					<h6>Loading your metadata</h6>
					<p>Please wait while your metadata is loaded and checked.</p>
				</div>
			</div>
		</div>
	</div>

	<div class="modal" id="progressProcessing" tabindex="-1" role="dialog" aria-labelledby="progressLoadingMetadata" aria-hidden="false" data-backdrop="static" data-keyboard="false">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="progressLoadingMetadata">Renaming Files</h5>
				</div>
				<div class="modal-body">
					<h6>Renaming your files</h6>
					<p>Please wait while your metadata is being updated and your files renamed.</p>
					<div id="processingProgressContainer">
						<div id="processingProgressBackground"></div>
						<div id="processingProgressBar"></div>
						<div id="processingProgressBarPercentage"></div>
					</div>
					<button type="button" class="btn btn-danger float-right" id="btnCancelProcessing">Cancel</button>
				</div>
			</div>
		</div>
	</div>

	
	<div class="modal modal-success" id="metadataFine" tabindex="-1" role="dialog" aria-labelledby="metadataFine" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="metadataFine">Metadata Loaded</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<h6>Your Metadata has been loaded and checked</h6>
					<p>The metadata you have loaded correctly lists all files and data.</p>
					<p>Please check your new metadata before choosing to "Start Processing" your files.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal error box for pre validation problems (i.e. metadata headers) -->
	<div class="modal modal-error" id="errorModalPre" tabindex="-1" role="dialog" aria-labelledby="errorModalPre" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="errorModalPre">Metadata Errors</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<h6>There are problems with your metadata headers</h6>
					<p>Please correct the errors before trying to refresh your data.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal error box for post error checking - like files named incorrectly -->
	<div class="modal modal-error" id="errorModalPost" tabindex="-1" role="dialog" aria-labelledby="errorModalPost" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="errorModalPost">Metadata Errors</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<h6>There are errors with your metadata</h6>
					<p>Use the information below to update your metadata file and correct the errors.</p>
					<p>"Refresh" your metadata once you have fixed all issues to try again.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-dismiss="modal">Ok</button>
				</div>
			</div>
		</div>
	</div>

	<!-- modal success box for renaming all the files -->
	<div class="modal modal" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModal" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="successModal">Processing Complete</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<h6>Your files have been renamed</h6>
					<p>Please check your metadata directory for your renamed files.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal modal" id="cancelModal" tabindex="-1" role="dialog" aria-labelledby="cancelModal" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="cancelModal">Processing Cancelled</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<h6>File renaming cancelled</h6>
					<p>You have chosen to cancel the renaming processing.</p>
					<p>Any files that have been renamed already will remain in your output directory.</p>
					<p>Refresh the your metadata before trying to start the renaming process again as some files may already exist.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
				</div>
			</div>
		</div>
	</div>

	<!-- The blue header bar at the top of the page -->
	<header id="pageHeader">
		<div class="container">
			<div class="row">
				<div class="col">
					<img src="../img/lrcfs-logo-white-transparent-bg.png" width="500px" />
				</div>
				<div class="col text-right">
					<img src="../img/Leverhulme_Trust_RGB_white.png" />
				</div>
			</div>
		</div>
	</header>

	<!-- Information about the application -->
	<div id="topInfo">
		<div class="container">
			<div class="row">
				<div class="col-8">
					<h1 class="display-4">LRCFS File Renamer</h1>
					<p class="lead">Welcome to the Leverhulme Research Centre for Forensic Science File Renamer.</p>
					<hr>
					<p>
						This application has been developed to help you automatically rename files for your project based on your metadata.
					</p>
					<p>
						With this application you can automatically rename hundreds of files from: <br />
						<strong>DCS_0002.jpg</strong> to <strong>20201231-Exp1-Rep2-UVLIGHT.jpg</strong>
					</p>
					<p>
						Not only will this make your files more meaningful to you, but it will also allow your data to be better understood by people that you collaborate with as well as any future researchers that want to work with your data.
					</p>
				</div>
				<div class="col-4">
					<div class="card text-center mt-2">
						<div class="card-body">
							<h5 class="card-title">Customise LRCFS Renamer</h5>
							<p class="card-text">You can create your own renamer configuration files that let you customise what metadata you expect and how you want your files to be renamed.</p>
							<a class="btn btn-primary" href="https://github.com/LRCFS/lrcfs-msb2019-photogrammetry" role="button" target="_blank"><span class="fa fa-dashboard fa-lg" aria-hidden="true"></span> Visit GitHub to find out more</a>
						</div>
					</div>				
				</div>
			</div>
		</div>
	</div>
	
	<!-- The getting started step i.e. select your project profile -->
	<div id="gettingStarted">
		<div class="container">
			<div class="row">
				<div class="col-6">
					<h2>1. Getting started</h2>
					<p>
						To start renaming your files, first we need to know what your metadata is going to look like and how you'd like to rename your files.
					</p>
					<p>
						Select the project you're working on from the drop down menu on the right.
					</p>
				</div>
				<div class="col-6">
					<h5>Select Project</h5>
					<select id="selectRenamer" name="selectRenamer" class="mdb-select md-form"></select><br />
					<div id="exampleDataDownload">
						<br />
						<button id="btnShowProjectSettings" class="btn btn-info btn-block" type="button" data-toggle="collapse" data-target="#renamerInfoCollapsible" aria-expanded="false" aria-controls="renamerInfoCollapsible">
							Show Project Settings
						</button>
						<br />
						<h5>Example Metadata</h5>
						<p>If you've not yet started collecting your metadata you can create an blank file for your selected project to make sure it will work correctly.</p>
						<button id="btnDownloadExampleCsv" class="btn btn-info btn-block">Create Blank Metadata File</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Information about the renamer profile loaded -->
	<div class="collapse" id="renamerInfoCollapsible">
		<div id="renamerInfo">
			<div class="container">
				<div class="row">
					<div class="col">
						<h4>Selected Project</h4>
						<hr/>
						<p><strong>Title:</strong> <span id="renamerName"></span></p>
						<p><strong>Webiste:</strong> <a id="renamerUrl" target="_blank">Visit website</a></p>
						<p><strong>Description:</strong> <span id="renamerDesc"></span></p>
					</div>
					<div class="col">
						<h4>Renamer Properties</h4>
						<hr/>
						<p><strong>Current Filename Column:</strong> <span id="renamerMetadataCurrentFilenameColumn"></span></p>
						<p><strong>Old Filename Column:</strong> <span id="renamerMetadataOldFilenameColumn"></span></p>
						<p><strong>New Filename Column:</strong> <span id="renamerMetadataNewFilenameColumn"></span></p>

						<p><strong>Trim Headers &amp; Data:</strong> <span id="renamerTrimHeadersAndData"></span></p>
						<p><strong>Null Data Tag:</strong> <span id="renamerNullDataTag"></span></p>
					</div>
					<div class="col">
						<h4>New Filename Data</h4>
						<hr/>
						<p><strong>Property Seperator:</strong> <span id="renamerFilenamePropertySeperator"></span></p>
						<p><strong>Value Seperator:</strong> <span id="renamerFilenameValueSeperator"></span></p>
						<span id="renamerColumns"></span>
					</div>
				</div>
				<div class="row">
					<div class="col">
						<br />
						<button class="btn btn-info float-right" type="button" data-toggle="collapse" data-target="#renamerInfoCollapsible" aria-expanded="false" aria-controls="renamerInfoCollapsible">
							Close Project Settings
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Load metadata / start processing steps -->
	<div id="operations">
		<div class="container">
			<div class="row">
				<div class="col">
					<h2>2. Load your Metadata</h2>
					<p>
						Now that we know what project you're working on, and if you're happy with the <a data-toggle="collapse" href="#renamerInfoCollapsible" role="button" aria-expanded="false" aria-controls="collapseExample">project settings outlined above</a>, we can load your metadata:
					</p>
					<p>
						<button id="btnFileSelect" class="btn btn-primary btn-block">Select Metadata File</button>
						<input type="text" class="form-control" id="selectedMetadataPath" placeholder="Selected metadata.csv..." disabled></input>
					</p>
					<h5>Refresh your Metadata</h5>
					<p>
						If you've made changes to your metadata to fix any errors, or even if you're just added new data since you last loaded it, click below to refresh and check all your files.
					</p>
					<p>
						<button id="btnRefershMetadata" class="btn btn-info btn-block" disabled>Refresh</button>
					</p>	
				</div>
				<div class="col">
					<div class="row">
						<div class="col">
							<h2>3. Rename your Files</h2>
							<p>If you're happy with your data being renamed as outline in the <a id="linkScrollToResults" href="#">Results panel</a> below, click "Start Processing" to begin renaming your files.</p>
							
							<!--<input id="chkCreateCopies" type="checkbox" checked data-toggle="toggle" data-on="Create Copies" data-off="Rename Originals" data-onstyle="success" data-offstyle="danger" data-width="180" data-height="39">-->
							<button id="btnRename" class="btn btn-success btn-block" disabled>Start Processing</button>
						</div>
					</div>
					<div class="row">
						<div class="col">
							<br />
							<h5>Output Directory</h5>
							<p>By default you files will be copied to a folder called 'output' that will be created in the same directory as your metadata file. To change this, click the button below to select a new directory.</p>
							<button id="btnSelectOutputDir" class="btn btn-info btn-block">Change Output Directory</button>
							<input id="txtOutputDir" type="text" class="form-control" disabled/><br />
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Error list for problems with CSV headers -->
	<div id="errorListPre">
		<div class="container">
			<div class="row">
				<div class="col">
					<h4>There are problems with the headings in your metadata</h4>
					<hr/>
					<p><strong>Please note that header names are case sensative.</strong><p></p>
					<div id="errorsDuplicateColumnHeading">
						<p><strong>Your selected metadata includes duplicate column names/headings.</strong></p>
						<p>Please remove/rename/replace all duplicate column headings as no two columns can have the same heading:</p>
						<ul id="errorsDuplicateColumn"></ul>
					</div>
					<div id="errorsMalformedColumnsHeading">
						<p><strong>Your headers contain single quotes around your headings. Please use double quotes to enclose all data if requied.</strong></p>
						<p>Please check that your following metadata headers do not use single quotes or use double quotes instead:</p>
						<p><small>Note: Not being able to correctly recognise your headers may results in more errors below. Please resolve this first before reloading your data to check for further errors.</small></p>
						<ul id="errorsMalformedColumns"></ul>
					</div>
					<div id="errorsMissingFilenameColumnHeading">
						<p><strong>Your selected Project requires a heading that specifies your filenames in your metadata, but it appears to be missing.</strong></p>
						<p>Please check your metadata contains the following header that specifies your filenames:</p>
						<ul id="errorsMissingFilenameColumn"></ul>
					</div>
					<div id="errorsMissingColumnsHeading">
						<p><strong>Your selected Project has some required headers for renaming your files, but the following headers are missing from your metadata.</strong></p>
						<p>Please check that your metadata contains the following headers:</p>
						<ul id="errorsMissingColumns"></ul>
					</div>
					<hr />
					<p>Once corrected in your metadata press the Refresh button to try again.</p>
				</div>
			</div>
		</div>
	</div>

	<!-- Error lists for problems with metadata checks -->
	<div id="errorLists">
		<div class="container">
			<div class="row" id="errorFilesMissing">
				<div class="col">
					<h4>Files Missing</h4>
					<hr />
					<p>The following files are missing and can not be found in the same folder as your metadata.</p>
					<p>
						Please check these files exist in:<br />
						<span id="errorFilesMissingFolder"></span>
					</p>
					<ul id="e1"></ul>
				</div>
			</div>
			<div class="row" id="errorFilenameExists">
				<div class="col">
					<h4>New Filename Exists</h4>
					<hr />
					<p>The following rows will generate new filenames that already exist in the output folder.</p>
					<p>
						Please move the existing files or change the output directory:<br />
						<span id="errorOutputFolder"></span>
					</p>
					<ul id="e2"></ul>
				</div>
			</div>
			<div class="row" id="errorSameCurrentFilename">
				<div class="col">
					<h4>Same Current Filename</h4>
					<hr />
					<p>The following rows of your metadata contain duplicate filenames. Duplicate filenames means that we can't assocaite one record of your metadata with that file and as such it can not be renamed.</p>
					<p>Please ensure that your metadata rows correctly reference the appropriate files and correct any errors.</p>
					<ul id="e3"></ul>
				</div>
			</div>
			<div class="row" id="errorSameNewFilename">
				<div class="col">
					<h4>Same New Filename</h4>
					<hr />
					<p>The following rows will generate new files that have the same name. Where different files represent different peices of data your metadata should individual distinguish them.</p>
					<p>Please ensure that metadata is correct and uniquely identifies each image.</p>
					<ul id="e4"></ul>
				</div>
			</div>
			<div class="row" id="errorText">
				<div class="col">
					<h4>Missing Data</h4>
					<hr />
					<p>The following rows have text that is missing.</p>
					<p>Please ensure that the following rows contain values or specifically use '<span id="errorEmptyData"></span>'.</p>
					<ul id="eText"></ul>
				</div>
			</div>
			<div class="row" id="errorTextOverMaxLength">
				<div class="col">
					<h4>Text too long</h4>
					<hr />
					<p>The following rows have text that is too long.</p>
					<p>Please ensure that the following rows contain text no longer than each column specifies.</p>
					<ul id="eTextMaxLength"></ul>
				</div>
			</div>
			<div class="row" id="errorNull">
				<div class="col">
					<h4>Empty/Null Data Errors</h4>
					<hr />
					<p>The following rows have data that cannot be empty/null.</p>
					<p>Please ensure that the following rows/columns contain data in the correct format.</p>
					<ul id="eNull"></ul>
				</div>
			</div>
			<div class="row" id="errorDate">
				<div class="col">
					<h4>Date Errors</h4>
					<hr />
					<p>The following rows have date columns that could not be parsed correctly.</p>
					<p>Please ensure that the following rows contain dates in the correct format.</p>
					<ul id="eDate"></ul>
				</div>
			</div>
			<div class="row" id="errorInt">
				<div class="col">
					<h4>Integer Number Errors</h4>
					<hr />
					<p>The following rows have integer (whole number) columns that could not be parsed correctly.</p>
					<p>Please ensure that the following rows contain only integers.</p>
					<ul id="eInt"></ul>
				</div>
			</div>
			<div class="row" id="errorFloat">
				<div class="col">
					<h4>Float Number Errors</h4>
					<hr />
					<p>The following rows have float (numbers with decimals places) columns that could not be parsed correctly.</p>
					<p>Please ensure that the following rows contain only floats.</p>
					<ul id="eFloat"></ul>
				</div>
			</div>
		</div>
	</div>

	<!-- The metadata list -->
	<div id="results">
		<!--<div class="container">
			<div class="row">
				<div class="col">
					<h4>Loaded Data</h4>
					<hr />
				</div>
			</div>
		</div>-->
		<div class="container-fluid">
			<div class="row">
				<div class="col">
					<div id="htmlout"></div>
				</div>
			</div>
		</div>
	</div>

	<!--<div id="bottomOperations">
		<div class="container">
			<div class="row">
				<div class="col">
					<button id="btnRenameBottom" class="btn btn-primary btn-block" disabled>Start Processing</button>
				</div>
			</div>
		</div>
	</div>-->

</body>
</html>
